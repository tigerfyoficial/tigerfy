<%- include('partials/visual_hottrack') %>

<main class="api-pix">
  <header>
    <h1>Integra√ß√µes de Gateways</h1>
    <p>Escolha, ative e gerencie seus gateways de pagamento via API PIX.</p>
  </header>

  <section class="gateway-grid">
    <% const gateways = [
      { nome: 'WiinPay', img: '/img/gateways/wiinpay.png', taxa: '4,99%', ativo: true, temToken: true, top: true },
      { nome: 'ParadisePag', img: '/img/gateways/paradisepag.png', taxa: '1 Real', ativo: false },
      { nome: 'OasyFy', img: '/img/gateways/oasyfy.png', taxa: '2,90%', ativo: false },
      { nome: 'PushinPay', img: '/img/gateways/pushinpay.png', taxa: '0,35 Centavos', ativo: false },
      { nome: 'SyncPay V2', img: '/img/gateways/syncpayv2.png', taxa: '0,35 Centavos', ativo: false },
      { nome: 'Hoopay', img: '/img/gateways/hoopay.png', taxa: '1,85%', ativo: false },
      { nome: 'ZeroOnePay', img: '', taxa: '‚Äî', soon: true },
      { nome: 'HorsePay', img: '', taxa: '‚Äî', soon: true }
    ]; %>

    <% gateways.forEach(g => { %>
      <div class="gateway-card <%= g.soon ? 'soon' : '' %> <%= g.ativo ? 'active' : '' %>">
        <div class="left">
          <% if (g.img) { %>
            <img src="<%= g.img %>" alt="<%= g.nome %>" class="gateway-logo" />
          <% } else { %>
            <div class="logo-placeholder"></div>
          <% } %>
          <div class="gateway-info">
            <% if (g.top) { %><span class="badge">üî• TOP 1</span><% } %>
            <div class="top-line">
              <h3><%= g.nome %></h3>
              <% if (g.ativo) { %><span class="status">‚óè Ativo</span><% } %>
            </div>
            <span class="method">M√âTODO: API PIX</span>
            <a href="#" target="_blank" class="taxa">Taxa: <%= g.taxa %></a>
          </div>
        </div>

        <div class="right">
          <% if (!g.soon) { %>
            <button class="btn glass token" onclick="openTokenModal('<%= g.nome %>')">
              <%= g.temToken ? 'Alterar Token' : 'Adicionar Token' %>
            </button>
            <button class="btn glass toggle <%= g.ativo ? 'on' : '' %>" onclick="toggleGateway(this)">
              <%= g.ativo ? 'Desativar' : 'Ativar Gateway' %>
            </button>
          <% } else { %>
            <button class="btn glass disabled">Em breve</button>
          <% } %>
        </div>
      </div>
    <% }) %>
  </section>

  <!-- üî• Gr√°fico de Status do PIX -->
  <section class="pix-status">
    <h2>Monitoramento de Status do Pix</h2>
    <div class="chart-wrapper">
      <canvas id="pixIssuesChart"></canvas>
    </div>
  </section>
</main>

<!-- Modal de Token -->
<div id="tokenModal" class="modal hidden">
  <div class="modal-content">
    <h2 id="modalTitle">Gerenciar Token</h2>
    <form id="tokenForm">
      <div id="tokenFields"></div>
      <div class="modal-actions">
        <button type="button" class="btn glass cancel" onclick="closeTokenModal()">Cancelar</button>
        <button type="submit" class="btn glass save">Salvar</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ========================
   Toggle visual do gateway
======================== */
function toggleGateway(el){
  const card = el.closest('.gateway-card');
  const isActive = card.classList.contains('active');
  if(isActive){
    card.classList.remove('active');
    el.innerText = 'Ativar Gateway';
    el.classList.remove('on');
    const status = card.querySelector('.status');
    if(status) status.remove();
  } else {
    document.querySelectorAll('.gateway-card').forEach(c => {
      c.classList.remove('active');
      const s = c.querySelector('.status');
      if(s) s.remove();
      const btn = c.querySelector('.btn.toggle');
      if(btn){ btn.classList.remove('on'); btn.innerText = 'Ativar Gateway'; }
    });
    card.classList.add('active');
    el.innerText = 'Desativar';
    el.classList.add('on');
    const topLine = card.querySelector('.top-line');
    const status = document.createElement('span');
    status.className = 'status';
    status.textContent = '‚óè Ativo';
    topLine.appendChild(status);
  }
}

/* ========================
   Modal de Token
======================== */
function openTokenModal(gateway){
  const modal = document.getElementById('tokenModal');
  const title = document.getElementById('modalTitle');
  const fields = document.getElementById('tokenFields');
  fields.innerHTML = '';

  title.textContent = `Integra√ß√£o - ${gateway}`;

  const configs = {
    'WiinPay': ['Token API'],
    'ParadisePag': ['Chave de API', 'C√≥digo do Produto'],
    'OasyFy': ['Public Key', 'Secret Key'],
    'PushinPay': ['API Token (Bearer)'],
    'SyncPay V2': ['Client ID (p√∫blica)', 'Client Secret (privada)'],
    'Hoopay': ['Client ID', 'Client Secret']
  };

  const campos = configs[gateway] || ['Token'];
  campos.forEach(campo => {
    const inputDiv = document.createElement('div');
    inputDiv.className = 'field';
    inputDiv.innerHTML = `
      <label>${campo}</label>
      <input type="text" placeholder="Insira ${campo.toLowerCase()}..." />
    `;
    fields.appendChild(inputDiv);
  });

  modal.classList.remove('hidden');
  setTimeout(()=>modal.classList.add('visible'), 10);
}

function closeTokenModal(){
  const modal = document.getElementById('tokenModal');
  modal.style.transition = "opacity 0.3s ease";
  modal.style.opacity = "0";
  setTimeout(() => {
    modal.classList.add('hidden');
    modal.classList.remove('visible');
    modal.style.opacity = "";
  }, 300);
}

/* =============================
   Gr√°fico de status do PIX
============================= */
window.addEventListener("load", () => {
  const ctx = document.getElementById('pixIssuesChart').getContext('2d');
  const data = {
    labels: ["04:00","07:00","10:00","13:00","16:00","19:00","22:00","01:00"],
    datasets: [{
      label: 'Problemas reportados',
      data: [1,3,7,10,9,14,5,2],
      fill: true,
      backgroundColor: 'rgba(255, 204, 0, 0.25)',
      borderColor: '#ffcc00',
      borderWidth: 2,
      tension: 0.35,
      pointBackgroundColor: '#ffcc00'
    }]
  };

  new Chart(ctx, {
    type: 'line',
    data,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1a1a1a',
          titleColor: '#ffcc00',
          bodyColor: '#fff',
          borderColor: 'rgba(255,204,0,0.2)',
          borderWidth: 1
        }
      },
      scales: {
        x: {
          ticks: { color: '#ccc', font: { size: 12 } },
          grid: { color: 'rgba(255,255,255,0.05)' }
        },
        y: {
          ticks: { color: '#ccc', font: { size: 12 } },
          grid: { color: 'rgba(255,255,255,0.05)' }
        }
      }
    }
  });
});
</script>

<style>

/* HEADER MAIS LARGO */
.api-pix header {
  width: 96%;
  max-width: 1500px;
  margin: 40px auto 20px;
}
.api-pix h1 {
  color: #ffcc00;
  font-size: 1.9rem;
  margin-bottom: 6px;
}
.api-pix p {
  color: #b3b3b3;
  font-size: 1rem;
  margin: 0;
}

/* GRID 3 COLUNAS */
.gateway-grid {
  width: 96%;
  max-width: 1500px;
  margin: 20px auto 60px;
  display: grid;
  grid-template-columns: repeat(3, minmax(360px, 1fr));
  gap: 24px 26px;
}

/* CARDS */
.gateway-card {
  background: rgba(255, 255, 255, 0.04);
  backdrop-filter: blur(18px);
  border-radius: 16px;
  padding: 24px 28px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.08);
  min-height: 135px;
  transition: all .3s ease;
  outline: 2px solid transparent;
  outline-offset: -2px;
}
.gateway-card.active {
  border-color: rgba(255, 204, 0, 0.5);
  outline: 2px solid rgba(255, 204, 0, 0.35);
  background: rgba(255, 255, 255, 0.06);
}

.left { display: flex; align-items: center; gap: 18px; }
.gateway-logo {
  width: 50px;
  height: 50px;
  object-fit: contain;
  border-radius: 10px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
}
.logo-placeholder {
  width: 50px; height: 50px;
  background: rgba(255,255,255,0.06);
  border-radius: 10px;
}
.gateway-info {
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 3px;
}

.badge {
  position: absolute;
  top: -24px;
  left: 0;
  background: linear-gradient(90deg, #ffcc00, #ff9900);
  color: #000;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 0.7rem;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(255, 204, 0, 0.25);
  overflow: hidden;
}

.top-line { display: flex; align-items: center; gap: 6px; }
.status {
  font-size: 0.7rem;
  color: #ffcc00;
  background: rgba(255,204,0,0.08);
  border: 1px solid rgba(255,204,0,0.25);
  padding: 1px 6px;
  border-radius: 5px;
}
.method { font-size: 0.85rem; color: #aaa; }
.taxa { color: #ffcc00; font-size: 0.85rem; text-decoration: none; }

/* =============================
   üî• BOT√ïES PREMIUM COMPACTOS
============================= */

.right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
}

/* base */
.btn.glass {
  width: 118px !important;
  height: 34px !important;
  padding: 0 !important;

  display: flex !important;
  justify-content: center !important;
  align-items: center !important;

  font-size: 0.78rem !important;
  font-weight: 600 !important;

  border-radius: 8px !important;
  border: 1px solid rgba(255, 204, 0, 0.32) !important;

  background: rgba(255, 204, 0, 0.14) !important;
  color: #ffcc00 !important;

  backdrop-filter: blur(8px) !important;
  transition: 0.18s ease-in-out !important;
}

/* hover */
.btn.glass:hover {
  background: rgba(255, 204, 0, 0.22) !important;
  border-color: rgba(255, 204, 0, 0.45) !important;
  box-shadow: 0 0 10px rgba(255, 204, 0, 0.35) !important;
}

/* ativo */
.btn.glass.on {
  background: linear-gradient(90deg,#ffcc00,#d4a100) !important;
  border-color: rgba(255, 204, 0, 0.6) !important;
  color: #000 !important;
  font-weight: 700 !important;
  box-shadow: 0 0 12px rgba(255, 204, 0, 0.45) !important;
}

/* token */
.btn.token { width: 118px !important }

/* desativado */
.btn.disabled {
  width: 118px !important;
  background: rgba(255,255,255,0.06) !important;
  border: 1px solid rgba(255,255,255,0.15) !important;
  opacity: 0.45 !important;
  color: #777 !important;
  cursor: not-allowed !important;
  filter: grayscale(1) !important;
}

/* gr√°fico */
.pix-status {
  width: 96%;
  max-width: 1500px;
  margin: 50px auto 80px;
  color: #ffcc00;
}
.pix-status h2 {
  font-size: 1.4rem;
  margin-bottom: 12px;
  text-shadow: 0 0 10px rgba(255,204,0,0.3);
}
.chart-wrapper {
  width: 100%;
  height: 430px;
  background: rgba(255,255,255,0.03);
  border-radius: 14px;
  padding: 20px 16px;
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 0 20px rgba(255,204,0,0.08);
}
#pixIssuesChart { width: 100%; height: 100%; display: block; }

/* modal */
.modal.hidden{ display:none; }
.modal.visible{ display:flex; opacity:1; }
.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(10px);
  align-items:center;
  justify-content:center;
  z-index:999;
  transition:opacity .3s ease;
  opacity:0;
}

.modal-content {
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:16px;
  padding:28px;
  width:400px;
  box-shadow:0 0 25px rgba(255,204,0,0.15);
  animation:fadeIn .3s ease;
}

.modal-content h2 {
  margin-top:0;
  color:#ffcc00;
  font-size:1.2rem;
  text-align:center;
}

.field { margin:12px 0; display:flex; flex-direction:column; }
.field label { font-size:0.85rem; color:#ccc; margin-bottom:4px; }
.field input {
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:8px;
  padding:8px 10px;
  color:#fff;
}

.modal-actions {
  margin-top:16px;
  display:flex;
  justify-content:space-between;
}

.btn.cancel{ color:#bbb; }
.btn.save{
  background:rgba(255,204,0,0.1);
  border-color:rgba(255,204,0,0.4);
  color:#ffcc00;
}

@keyframes pageFadeQuick {
  0% { opacity: 0; }
  100% { opacity: 1; }
}
.api-pix {
  animation: pageFadeQuick .25s ease-in forwards;
  will-change: opacity;
}

</style>
